mouse_skin_size_control/2024_analysis


INSTALL: 

1) Use anaconda to create a new environment: conda create -n NAME_HERE pyhton=3.9. Activate the new environment using conda activate NAME_HERE

3) Install the required packages using conda: conda install -f requirements.txt

4) Pip required packages:
pip install pystackreg (tested version = 0.2.7)
pip install trimesh (tested version = 3.18.0)

5) Download the repository from github: github.com/xies/xiesUtil

6) Add xiesUtils and mouse_skin_size_control/utils to the python path: conda develop /PATH/TO/xiesUtils and conda develop /PATH/TO/mouse_skin_size_control/utils

All the code are were developed as scripts to be run in a ipython-compatible IDE.



EXAMPLE USAGE:

To use annotate cell and microenvironment features, first generate high-quality 3D segmentation masks for cell and nuclear shapes. For mouse epidermal skin images, cellposeâ€™s 3D stitching mode works reasonably well. However, it is still necessary to extensively review the automatic annotations, or use the cellpose 2.0 human-in-the-loop training interface to refine the segmentation models. 

--

test_dataset.zip


(1) A small test image test_data/example_mouse_skin_image.tif is provided. The dimensions are: [Z,T,Channel,Y,X]. The channels are as follows:
1 - FUCCI-Cdt1 reporter
2 - Cell outline reporter
3 - Nuclear reporter
4 - nuclear masks
5 - cytoplasmic masks
6 - tracked cell masks
For the example the dataset was cropped to follow trackID = 374 in channel 6.

(2) A basal layer contact map is needed to encode the cell-cell contacts within the basal layer. This can be generated by re-slicing the 3D tissue image to follow the surface of the basal layer. For convenience, the contact map for the example image is provided in test_data/example_2d_contact_map.tif

(3) A flattened sub-basal collagen image is provided, which is a re-slicing in z-axis of the cytoplasmic masks (channel 4) based on the location of the epidermal-dermal boundary

(4) Collagen orientation gradient images: the X and Y- gradient images of the collagen layer is provided from which collagen orientations can be estimated

(5) Heightmaps: the z-axis index of the epidermal-dermal boundary at that X,Y coordinate

--

The script interface can be followed in sequence.

1__annotate_adjacency_from_flat_cortical_seg: generates cell-cell adjacency matrices from the contact map (also called flat cortical segmentations). The convention is that nuclear segmentation IDs will be used to uniquely identity each cell. Run-time <10s on demo.
2__collate_nuclear_and_cyto: map cytoplasmic segmentations onto nuclear segmentations. Run time <10s on demo
3__annotate_tissue_densely: generates cell and neighborhood features. Run time <30s on demo
3a__plot_diagnostics: optional plotting tools
4__annotate_basal_dividing_cells: generate image statistics for dividing cells. Run time <10s on demo.
5__combine_dividing_cells_and_dense_tissue_annotations: combine dividing cell features and microenvironment features. Run time <1s on demo

This will generate an overall CSV file called ts_features.csv, which contains a large table for all dividing cells over time, and their respective microenvironment features.

This matrix is directly used by scripts in tissue_dynamics_model to perform statistical modeling of the predictor of the G1/S transition. All scripts begin with 1__prepare_data_matrix, which prepares a sanitized and standardized data matrix, which is subsequently used to construct different models.

Expected run time: <1 min for test dataset.
